# OMG Changelog Configuration
# Documentation: https://git-cliff.org/docs/configuration
#
# Philosophy: User-focused changelogs that explain IMPACT, not implementation
# - What changed for the user?
# - Why does this matter?
# - What should they do?

[changelog]
header = """
# Changelog

All notable changes to OMG are documented here.

OMG is the fastest unified package manager for Linux, replacing pacman, yay, nvm, pyenv, rustup, and more with a single tool.

**Performance**: 22x faster searches than pacman, 59-483x faster than apt-cache on Debian/Ubuntu
**Unified**: System packages + 8 language runtimes in one CLI
**Secure**: Built-in SLSA, PGP, SBOM, and audit logs

---

"""

# User-focused template with impact statements
body = """
{% if version -%}
## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else -%}
## [Unreleased]
{% endif -%}

{% for group, commits in commits | group_by(attribute="group") -%}
### {{ group | striptags | trim | upper_first }}

{% for commit in commits -%}
{%- if commit.scope -%}
- **{{ commit.scope | upper_first }}**: {{ commit.message | upper_first | trim_end_matches(pat=".") }}
{%- else -%}
- {{ commit.message | upper_first | trim_end_matches(pat=".") }}
{%- endif %}
{%- if commit.breaking %} âš ï¸ **BREAKING CHANGE**{% endif %}
{%- if commit.body %}
  {% for line in commit.body | split(pat="\n") -%}
  {%- if line | trim != "" %}
  {{ line | trim | replace(from="- ", to="  - ") }}
  {%- endif %}
  {% endfor -%}
{%- endif %}
{% endfor -%}
{% endfor -%}

"""

footer = """
---
{% if previous %}{% if previous.version %}
**Full Changelog**: https://github.com/PyRo1121/omg/compare/{{ previous.version }}...{{ version }}
{% endif %}{% endif %}
<!-- Generated by git-cliff -->
"""

trim = true
postprocessors = [
    # Clean up Co-Authored-By lines
    { pattern = '\n\n.*Co-Authored-By:.*\n', replace = "\n" },
    # Remove multiple blank lines
    { pattern = '\n\n\n+', replace = "\n\n" },
]

[git]
conventional_commits = true
filter_unconventional = false  # Include all commits, we'll categorize them
split_commits = false

commit_preprocessors = [
    # Extract ticket numbers and convert to links
    { pattern = '#(\d+)', replace = "[#$1](https://github.com/PyRo1121/omg/issues/$1)" },
    # Clean up emoji-heavy commits
    { pattern = '^(âš¡|ğŸš€|âœ¨|ğŸ›|ğŸ“|ğŸ”¥|ğŸ’š|ğŸ‘·|ğŸ“¦|ğŸ”§|ğŸ¨)', replace = "" },
]

commit_parsers = [
    # === USER-FACING CHANGES (Priority) ===

    # New Features (what users can now do)
    { message = "^feat", group = "âœ¨ New Features" },
    { message = "^add", group = "âœ¨ New Features" },

    # Performance Improvements (speed/efficiency gains)
    { message = "^perf", group = "âš¡ Performance" },
    { message = "^optim", group = "âš¡ Performance" },
    { message = ".*faster.*", group = "âš¡ Performance" },
    { message = ".*performance.*", group = "âš¡ Performance" },

    # Bug Fixes (things that now work correctly)
    { message = "^fix", group = "ğŸ› Bug Fixes" },
    { message = "^bugfix", group = "ğŸ› Bug Fixes" },
    { message = "^patch", group = "ğŸ› Bug Fixes" },

    # Security (critical for users to know)
    { message = "^sec", group = "ğŸ”’ Security" },
    { body = ".*security.*", group = "ğŸ”’ Security" },
    { message = ".*vulnerability.*", group = "ğŸ”’ Security" },
    { message = ".*CVE.*", group = "ğŸ”’ Security" },

    # Breaking Changes (require user action)
    { message = ".*breaking.*", group = "âš ï¸  Breaking Changes" },
    { message = ".*BREAKING.*", group = "âš ï¸  Breaking Changes" },

    # Documentation (helps users understand)
    { message = "^docs?", group = "ğŸ“š Documentation" },
    { message = "^doc\\(", group = "ğŸ“š Documentation" },

    # Dependencies (transparency on what changed)
    { message = "^deps?", group = "ğŸ“¦ Dependencies" },
    { message = "^build\\(deps", group = "ğŸ“¦ Dependencies" },
    { message = ".*upgrade.*dependency.*", group = "ğŸ“¦ Dependencies" },

    # === INTERNAL CHANGES (Lower priority in changelog) ===

    # Refactoring (should be invisible to users, but shows ongoing improvement)
    { message = "^refactor", group = "â™»ï¸  Refactoring" },
    { message = "^reorganize", group = "â™»ï¸  Refactoring" },

    # Testing (builds confidence)
    { message = "^test", group = "ğŸ§ª Testing" },
    { message = "^tests", group = "ğŸ§ª Testing" },

    # CI/CD (transparency on release process)
    { message = "^ci", group = "ğŸ‘· CI/CD" },
    { message = "^cd", group = "ğŸ‘· CI/CD" },

    # === SKIP THESE (Too noisy for users) ===

    # Skip release commits (redundant)
    { message = "^chore\\(release\\)", skip = true },
    { message = "^Release v", skip = true },
    { message = "^release:", skip = true },
    { message = "^Bump version", skip = true },

    # Skip trivial chores
    { message = "^chore: remove.*", skip = true },
    { message = "^chore: update.*lock.*", skip = true },
    { message = "^chore: format.*", skip = true },
    { message = "^style:", skip = true },
    { message = "^revert:", skip = true },

    # Skip generic/placeholder commits
    { message = "^WIP", skip = true },
    { message = "^wip", skip = true },
    { message = "^notes$", skip = true },
    { message = "^temp", skip = true },
    { message = "^tmp", skip = true },

    # Catch-all for remaining chores (group but deprioritize)
    { message = "^chore", group = "ğŸ”§ Maintenance" },
]

protect_breaking_commits = true
filter_commits = false

# Match semantic version tags
tag_pattern = "v[0-9]*"

# Skip pre-release/beta tags in changelog
skip_tags = ".*beta.*|.*alpha.*|.*rc.*"
ignore_tags = ""

topo_order = false
sort_commits = "newest"  # Most recent changes first (users care about latest)

# === LINK GENERATION ===
[remote.github]
owner = "PyRo1121"
repo = "omg"
